{"ast":null,"code":"import _defineProperty from \"@babel/runtime/helpers/defineProperty\";\nimport _readOnlyError from \"@babel/runtime/helpers/readOnlyError\";\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport settings from \"../config/settings\";\nimport { create } from \"apisauce\";\nimport storage from \"./storage\";\nvar apiClient = create({\n  baseURL: \"https://api.openweathermap.org/data/2.5/\",\n  timeout: 300000,\n  timeoutErrorMessage: \"Timeout Error: Slow or no connection.\"\n});\n\nvar getCity = function getCity(city) {\n  var current, onecall;\n  return _regeneratorRuntime.async(function getCity$(_context) {\n    while (1) {\n      switch (_context.prev = _context.next) {\n        case 0:\n          _context.prev = 0;\n          _context.next = 3;\n          return _regeneratorRuntime.awrap(apiClient.get(\"weather?q=\" + city + \"&appid=\" + settings.apiKey));\n\n        case 3:\n          current = _context.sent;\n\n          if (!current.ok) {\n            _context.next = 13;\n            break;\n          }\n\n          if (!(current.data.cod !== 200)) {\n            _context.next = 7;\n            break;\n          }\n\n          return _context.abrupt(\"return\");\n\n        case 7:\n          _context.next = 9;\n          return _regeneratorRuntime.awrap(onecallReq(current.data.coord.lat, current.data.coord.lon));\n\n        case 9:\n          onecall = _context.sent;\n          return _context.abrupt(\"return\", {\n            loc: {\n              city: current.data.name,\n              country: current.data.sys.country\n            },\n            data: onecall.data\n          });\n\n        case 13:\n          return _context.abrupt(\"return\");\n\n        case 14:\n          _context.next = 20;\n          break;\n\n        case 16:\n          _context.prev = 16;\n          _context.t0 = _context[\"catch\"](0);\n          console.log(_context.t0);\n          return _context.abrupt(\"return\");\n\n        case 20:\n        case \"end\":\n          return _context.stop();\n      }\n    }\n  }, null, null, [[0, 16]], Promise);\n};\n\nvar getCoords = function getCoords(lat, lon) {\n  var current, loc, onecall;\n  return _regeneratorRuntime.async(function getCoords$(_context2) {\n    while (1) {\n      switch (_context2.prev = _context2.next) {\n        case 0:\n          _context2.prev = 0;\n          _context2.next = 3;\n          return _regeneratorRuntime.awrap(apiClient.get(\"weather?lat=\" + lat + \"&lon=\" + lon + \"&appid=\" + settings.apiKey));\n\n        case 3:\n          current = _context2.sent;\n\n          if (!current.ok) {\n            _context2.next = 14;\n            break;\n          }\n\n          if (!(current.data.cod !== 200)) {\n            _context2.next = 7;\n            break;\n          }\n\n          return _context2.abrupt(\"return\");\n\n        case 7:\n          loc = {\n            city: current.data.name,\n            country: current.data.sys.country\n          };\n          _context2.next = 10;\n          return _regeneratorRuntime.awrap(onecallReq(current.data.name, current.data.coord.lat, current.data.coord.lon));\n\n        case 10:\n          onecall = _context2.sent;\n          return _context2.abrupt(\"return\", {\n            loc: loc,\n            data: onecall.data\n          });\n\n        case 14:\n          return _context2.abrupt(\"return\");\n\n        case 15:\n          _context2.next = 21;\n          break;\n\n        case 17:\n          _context2.prev = 17;\n          _context2.t0 = _context2[\"catch\"](0);\n          console.log(_context2.t0);\n          return _context2.abrupt(\"return\");\n\n        case 21:\n        case \"end\":\n          return _context2.stop();\n      }\n    }\n  }, null, null, [[0, 17]], Promise);\n};\n\nvar onecallReq = function onecallReq(loc, lat, lon) {\n  var res;\n  return _regeneratorRuntime.async(function onecallReq$(_context3) {\n    while (1) {\n      switch (_context3.prev = _context3.next) {\n        case 0:\n          _context3.next = 2;\n          return _regeneratorRuntime.awrap(apiClient.get(\"onecall?lat=\" + lat + \"&lon=\" + lon + \"&exclude=minutely&appid=\" + settings.apiKey));\n\n        case 2:\n          res = _context3.sent;\n\n          if (!res.ok) {\n            _context3.next = 11;\n            break;\n          }\n\n          _context3.next = 6;\n          return _regeneratorRuntime.awrap(storage.storeItems(_objectSpread({\n            loc: loc\n          }, res.data)));\n\n        case 6:\n          _context3.next = 8;\n          return _regeneratorRuntime.awrap(storage.formatResponse(res.data));\n\n        case 8:\n          return _context3.abrupt(\"return\", _context3.sent);\n\n        case 11:\n          _readOnlyError(\"res\");\n\n          _context3.next = 14;\n          return _regeneratorRuntime.awrap(storage.getItems(loc.city));\n\n        case 14:\n          res = _context3.sent;\n          return _context3.abrupt(\"return\", res);\n\n        case 16:\n        case \"end\":\n          return _context3.stop();\n      }\n    }\n  }, null, null, null, Promise);\n};\n\nexport default {\n  getCity: getCity,\n  getCoords: getCoords\n};","map":{"version":3,"sources":["D:/Node.Js/React Native/weather/app/api/weather.js"],"names":["settings","create","storage","apiClient","baseURL","timeout","timeoutErrorMessage","getCity","city","get","apiKey","current","ok","data","cod","onecallReq","coord","lat","lon","onecall","loc","name","country","sys","console","log","getCoords","res","storeItems","formatResponse","getItems"],"mappings":"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","sourcesContent":["import settings from \"../config/settings\";\r\nimport { create } from \"apisauce\";\r\nimport storage from \"./storage\";\r\n\r\nconst apiClient = create({\r\n  baseURL: `https://api.openweathermap.org/data/2.5/`,\r\n  timeout: 300000,\r\n  timeoutErrorMessage: \"Timeout Error: Slow or no connection.\",\r\n});\r\n\r\nconst getCity = async (city) => {\r\n  try {\r\n    const current = await apiClient.get(\r\n      `weather?q=${city}&appid=${settings.apiKey}`\r\n    );\r\n    if (current.ok) {\r\n      if (current.data.cod !== 200) {\r\n        return;\r\n      }\r\n      const onecall = await onecallReq(\r\n        current.data.coord.lat,\r\n        current.data.coord.lon\r\n      );\r\n\r\n      return {\r\n        loc: { city: current.data.name, country: current.data.sys.country },\r\n        data: onecall.data,\r\n      };\r\n    } else return;\r\n  } catch (err) {\r\n    console.log(err);\r\n    return;\r\n  }\r\n};\r\n\r\nconst getCoords = async (lat, lon) => {\r\n  try {\r\n    // Here try to get from storage\r\n    const current = await apiClient.get(\r\n      `weather?lat=${lat}&lon=${lon}&appid=${settings.apiKey}`\r\n    );\r\n    if (current.ok) {\r\n      if (current.data.cod !== 200) return;\r\n      const loc = {\r\n        city: current.data.name,\r\n        country: current.data.sys.country,\r\n      };\r\n      const onecall = await onecallReq(\r\n        current.data.name,\r\n        current.data.coord.lat,\r\n        current.data.coord.lon\r\n      );\r\n      return {\r\n        loc,\r\n        data: onecall.data,\r\n      };\r\n    } else return;\r\n  } catch (err) {\r\n    console.log(err);\r\n    return;\r\n  }\r\n};\r\n\r\nconst onecallReq = async (loc, lat, lon) => {\r\n  const res = await apiClient.get(\r\n    `onecall?lat=${lat}&lon=${lon}&exclude=minutely&appid=${settings.apiKey}`\r\n  );\r\n  // Here trycatch the error\r\n  if (res.ok) {\r\n    await storage.storeItems({ loc, ...res.data });\r\n    return await storage.formatResponse(res.data);\r\n  } else {\r\n    res = await storage.getItems(loc.city);\r\n    return res;\r\n  }\r\n};\r\n\r\nexport default { getCity, getCoords };\r\n"]},"metadata":{},"sourceType":"module"}